![banner](https://raw.githubusercontent.com/Azdabat/assets/main/cyber_banner_dark_react2shell_etherrat.jpg)

<h1 align="center">React2Shell + EtherRAT Combined Detection Engineering Study</h1>
<h3 align="center">Authored by Ala Dabat</h3>

---

# Table of Contents
- [1. Introduction](#1-introduction)
- [2. Threat Overview](#2-threat-overview)
- [3. Why React2Shell and EtherRAT Are Linked](#3-why-react2shell-and-etherrat-are-linked)
- [4. Detection Engineering Philosophy](#4-detection-engineering-philosophy)
- [5. Threat Modelling SOP](#5-threat-modelling-sop)
- [6. MITRE Mapping](#6-mitre-mapping)
- [7. Combined Attack Chain](#7-combined-attack-chain)
- [8. Attack Chain Diagrams](#8-attack-chain-diagrams)
- [9. Segmented Detection Architecture](#9-segmented-detection-architecture)
- [10. High-Level Rule Responsibilities](#10-high-level-rule-responsibilities)
- [11. Summarised Rulepack (Readme-Optimised)](#11-summarised-rulepack-readme-optimised)
- [12. Full Detection Rules (KQL)](#12-full-detection-rules-kql)
- [13. SOC L3 Hunting SOP](#13-soc-l3-hunting-sop)
- [14. NIST-Aligned IR Workflow](#14-nist-aligned-ir-workflow)
- [15. Repository Structure](#15-repository-structure)
- [16. Conclusion](#16-conclusion)

---

# 1. Introduction

This repository documents a **complete, combined detection-engineering study** for:

- **React2Shell** — Web-tier RCE via React/Next.js SSR deserialization bugs  
- **EtherRAT** — Blockchain-driven Rust implant deployed via malicious VSCode extensions  

Both threats have been observed across **DPRK-linked crypto theft campaigns**, fintech compromises, developer-targeted intrusion sets, and modern supply-chain attacks.

This README is designed to serve as a **full detection engineering deliverable**, containing:

- Threat modelling  
- MITRE mapping  
- Kill-chain reconstruction  
- ASCII & Mermaid diagrams  
- Segmented detection architecture  
- Rule responsibilities  
- Summarised detection logic  
- Full KQL rules (in a single block at the end)  
- IR workflow & SOC L3 SOP  

The methodology follows your established style from the **SilverFox / ValleyRAT** and **Stego Loader** studies.

---

# 2. Threat Overview

## **React2Shell – Web-Tier SSR RCE**
A rapidly evolving cluster of **React/Next.js deserialization RCE vulnerabilities** enabling:

- Server-side execution of arbitrary OS commands  
- Abuse of Node.js, IIS Express, nginx, httpd  
- Shell spawning (PowerShell/bash)  
- AMSI bypasses & encoded payloads  
- curl/wget fileless loaders  
- Secrets extraction (`.env`, API tokens, wallet keys)  
- Pivoting into CI/CD infrastructure  

React2Shell represents the **server-side entry point**.

---

## **EtherRAT – Blockchain-Controlled Rust Implant**
A highly advanced RAT delivered via:

- **Malicious VSCode extensions**  
- **Supply-chain poisoned npm/pip/rust crates**  
- **Fake dev-tool updates**  

Unique traits:

- Blockchain-based C2 (Ethereum/Solana RPC calls)  
- Rust-based loaders → cross-platform + obfuscation  
- Secrets/wallet/key theft  
- Persistence (tasks/systemd)  
- CI/CD intrusion paths  
- Stealthy operator tasking through blockchain metadata  

EtherRAT represents the **developer-side persistence layer**.

---

# 3. Why React2Shell and EtherRAT Are Linked

Although different in delivery vector, they form **two halves of a single supply-chain attack pathway**.

### **React2Shell (Server RCE) → Extract Secrets → CI/CD Compromise**  
From server RCE, attackers steal:

- Deployment keys  
- GitHub tokens  
- CI/CD secrets  
- Wallet seeds or API credentials  
- Internal API URLs  

### **EtherRAT (Dev Implant) → Persistent Control → Supply Chain Poisoning**  
Once inside dev infrastructure, attackers:

- Implant VSCode extensions  
- Deploy Rust loaders  
- Access private repos  
- Modify packages or build pipelines  
- Steal wallet keys  
- Re-deploy malicious production updates  

This creates an **attack feedback loop**:

~~~
Server Compromise → Steal Secrets → Poison Developer Tools → Implant Dev Hosts → Influence Builds → Reinfect Production
~~~


This model mirrors DPRK crypto theft operational workflows.

---

# 4. Detection Engineering Philosophy

This study follows your standard methodology:

### 4.1 **Behaviour-First Detection**
Avoiding IOCs entirely.  
Both threats rely on **tooling and process behaviour**, not static indicators.

### 4.2 **Segmentation Over Monolithic Rules**
Each attack stage has distinct telemetry:

- Web engines (node.exe, w3wp.exe)  
- Dev tools (Code.exe)  
- Rust binaries  
- Blockchain RPC network flows  
- Secrets access (file reads, command lines)  

Combining all into one rule leads to:

- Timeouts  
- Over-joins  
- Degraded fidelity  
- Missed data  

Segmented rules solve this.

### 4.3 **Environment-Agnostic Hunting**
Your rules do not assume a specific cloud, EDR mode, or OS flavour.

### 4.4 **IR Priority Separation**
Some detections require immediate isolation (e.g., web server spawning PowerShell), while others require triage (e.g., curl downloads).

---

# 5. Threat Modelling SOP

The modelling follows your documented L3 workflow:

## 5.1 Attack Surface Enumeration
- Web servers running Node.js / Next.js  
- Developer workstations (VSCode, npm, git)  
- CI/CD runners  
- Wallet/crypto API services  

## 5.2 Behavioural Decomposition

### **React2Shell Stages**
1. SSR RCE  
2. Shell spawn  
3. curl/wget stage  
4. AMSI bypass / encoded script  
5. Secrets recon  
6. Persistence  
7. Lateral movement  

### **EtherRAT Stages**
1. Malicious extension delivery  
2. Rust loader execution  
3. Blockchain RPC tasking  
4. Secrets/wallet theft  
5. Persistence creation  
6. Pivot into CI/CD  

## 5.3 Telemetry Mapping
Relevant tables:

- `DeviceProcessEvents`  
- `DeviceNetworkEvents`  
- `DeviceFileEvents`  
- `DeviceRegistryEvents`  
- `DeviceImageLoadEvents`  

## 5.4 Fidelity Assessment

| Behaviour | Fidelity | Notes |
|----------|----------|-------|
| Web server → shell | Very High | Almost always malicious |
| VSCode → shell | High | Strong EtherRAT signal |
| Blockchain RPC | Medium | Rare in normal enterprise |
| curl/wget loaders | Medium | Some benign uses |
| Secrets recon | High | Investigate immediately |
| Rust unsigned EXEs | High | Strong implant signal |

---

# 6. MITRE Mapping

| MITRE Tactic | Technique | Description |
|--------------|-----------|-------------|
| Initial Access | T1190 | Public-facing app exploit (React2Shell) |
| Initial Access | T1195 | Supply-chain / dev tools compromise (EtherRAT) |
| Execution | T1059 | PowerShell, bash, cmd |
| Execution | T1204 | User execution of malicious extensions |
| Persistence | T1053 | Scheduled tasks / cron |
| Persistence | T1546 | VSCode extension persistence |
| Defense Evasion | T1562.001 | AMSI bypass |
| Defense Evasion | T1027 | Obfuscation (base64, Rust) |
| Credential Access | T1552 | Reading secrets/wallets |
| Discovery | T1526 | Environment variable scan |
| Command & Control | T1102 | Blockchain RPC C2 |
| Exfiltration | T1041 | Data over approved channels |
| Impact | T1490 | App/service trojanisation |

---

# 7. Combined Attack Chain

### Unified kill chain across both intrusion sets:

**React2Shell → CI/CD secrets → malicious VSCode extension → EtherRAT → blockchain C2 → persistence → reinfection.**

---

# 8. Attack Chain Diagrams

## 8.1 ASCII Diagram

~~~
[React2Shell RCE]
|
v
[Web Shell Execution]
|
v
[Secrets Harvest (.env / tokens)]
|
v
[CI/CD Access Gained]
|
v
[Malicious VSCode Extension Delivered]
|
v
[Developer Implant (EtherRAT)]
|
v
[Blockchain RPC C2]
|
v
[Secrets / Wallet Theft]
|
v
[Supply-Chain Poisoning / Reinfection]
~~~


## 8.2 Mermaid Flowchart (GitHub-Safe)
```mermaid
flowchart TD
A[React2Shell: SSR RCE] --> B[Server Shell Spawn]
B --> C[Secrets Harvest Env Tokens] 

C --> D[CI/CD Access]
D --> E[Malicious VSCode Extension]
E --> F[EtherRAT Rust Loader]
F --> G[Blockchain C2: RPC Tasking]
G --> H[Secrets / Wallet Recon]
H --> I[CI/CD Lateral Movement]
I --> J[Supply Chain Compromise]
