# Combined React2Shell + EtherRAT Detection & Incident Response Pack  
### Author: Ala Dabat  
### Category: Advanced Threat Hunting & Detection Engineering  
### Scope: Web-Tier RCE (React2Shell) + Developer Implant (EtherRAT)  
### Platforms: Windows + Linux  
### Data Sources: Microsoft Defender for Endpoint (MDE), Azure Sentinel (DeviceProcessEvents, DeviceNetworkEvents, FileEvents)

---

# 1. Executive Summary

This pack unifies detection logic for **two high-impact modern threat classes** that frequently appear together in supply chain intrusions:

## **1. React2Shell**
A server-side RCE class targeting **Next.js / React SSR deserialization**, delivering operator-grade behaviours:
- Web server → OS shell execution  
- Payload staging (curl/wget/IWR/certutil)  
- AMSI bypass + obfuscated loaders  
- PowerShell/bash execution  
- Secrets harvesting (.env, SSH keys, wallet keys)  
- Early persistence  
- Lateral movement preparation  

## **2. EtherRAT**
A blockchain-controlled implant typically deployed via:
- Malicious VSCode extensions  
- Developer tooling supply chain abuse  
- Rust-based loaders  
- Blockchain C2 (Ethereum/Solana RPC)  
- Secrets theft  
- Persistence via tasks/systemd  

---

# 2. Why These Threats Are Connected

Although React2Shell (server-side RCE) and EtherRAT (developer workstation implant) appear unrelated, **they form a full supply-chain kill chain when combined**:

### **React2Shell = Entry into production servers**  
### **EtherRAT = Entry into developer ecosystem**  

Once both sides are compromised, attackers can:
- Extract secrets from production servers → poison CI/CD → deploy malicious VSCode extensions → implant EtherRAT → steal wallet keys → push malicious updates → redeploy malware back into servers.

This “feedback loop” is **identical to DPRK-linked crypto theft operations**.

---

# 3. Unified Attack Chain Diagram (GitHub-Safe Mermaid)

~~~mermaid
flowchart TD
    A[React2Shell: SSR Deserialization RCE] --> B[Server-Side Shell Execution]
    B --> C[Secrets Harvested (.env, Tokens, Keys)]
    C --> D[CI/CD or Repo Access via Leaked Secrets]
    D --> E[Malicious VSCode Extension Delivered]
    E --> F[Developer Workstation Compromised]
    F --> G[EtherRAT Rust Implant Activated]
    G --> H[Blockchain C2: Encrypted Tasking]
    H --> I[Recon: Keys, Wallets, SSH, Tokens]
    I --> J[Lateral Movement into Production & CI/CD]
    J --> K[Crypto Theft / Code Signing Abuse / Supply Chain Compromise]
~~~

# 4. MITRE ATT&CK Mapping (Unified)

| Stage                         | Description                                     | Techniques              |
| ----------------------------- | ----------------------------------------------- | ----------------------- |
| **Initial Access**            | SSR deserialization; malicious VSCode extension | T1190, T1195            |
| **Execution**                 | PowerShell/bash/Rust loader                     | T1059, T1059.001, T1204 |
| **Persistence**               | Cron, systemd, scheduled tasks, VSCode hooks    | T1053, T1546, T1547     |
| **Privilege/Defense Evasion** | AMSI bypass, reflection, obfuscation            | T1027, T1562.001        |
| **Discovery**                 | Reading `.env`, `.ssh`, key stores              | T1526, T1003            |
| **C2**                        | Ethereum/Solana RPC, blockchain metadata        | T1071.001, T1102        |
| **Collection**                | Wallet/SSH/Secrets harvesting                   | T1552, T1555            |
| **Lateral Movement**          | CI/CD pivoting, token abuse                     | T1550, T1021            |
| **Impact**                    | Crypto theft, supply chain compromise           | T1490, T1556            |

# 5. Threat Model (Unified)#

**Adversary Goals**
Obtain crypto assets or signing certificates
Compromise developer ecosystems
Steal secrets from web servers
Move laterally into CI/CD
Deploy implants that survive takedown
Use blockchain for resilient C2

**Key Indicators**

Web server spawning shell processes
VSCode spawning PowerShell/bash
Rust executables with unsigned metadata
Blockchain RPC calls from endpoints that do not develop blockchain code
Secrets/environment variable access
Immediate persistence creation

# 6. High-Fidelity Detection Rules
# SECTION A — React2Shell (Web Tier RCE)

# A1 — Web Server → Shell Execution

'''KQL
DeviceProcessEvents
| where InitiatingProcessFileName in ("node.exe","w3wp.exe","httpd.exe","nginx")
| where FileName in ("powershell.exe","pwsh.exe","cmd.exe","bash","sh")
'''





